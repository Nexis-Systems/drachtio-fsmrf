<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: conference.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: conference.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var Emitter = require('events').EventEmitter ;
var noop = require('node-noop').noop;
var util = require('util') ;
var only = require('only') ;
var _ = require('lodash') ;
var debug = require('debug')('drachtio-fsmrf') ;

var State = {
  NOT_CREATED: 1,
  CREATED: 2,
  DESTROYED: 3
};

/**
 * an audio or video conference mixer.  Conferences may be created on the fly by simply joining an endpoint
 * to a named conference without explicitly creating a Conference object.  The main purpose of the Conference
 * object is to enable the ability to create a conference on the media server without having an inbound call
 * (e.g., to create a scheduled conference at a particular point in time).
 *
 * @constructor
 * @param {Endpoint} endpoint - endpoint that will provide the control connection to the conference
 * @param {String}   name  - conference name
 * @param {Conference~createOptions}  [opts] - conference-level configuration options
 * @param {Conference~createCallback} cb - callback invoked when conference is created
 */
function Conference( endpoint, name, opts, cb ) {
  Emitter.call(this); 

  if( typeof opts === 'function') {
    cb = opts ;
    opts = {} ;
  }

  this._endpoint = endpoint ;
  this.name = name ;
  this.state = State.NOT_CREATED ;
  this.memberId = -1 ;
 
  this._endpoint.conn.subscribe('all') ;
 
  this._endpoint.conn.on('esl::event::CUSTOM::*', this._onConferenceEvent.bind(this)) ;
 
  opts.flags = opts.flags || {} ;
  _.extend( opts.flags, {
    ghost: true,
    endconf: true,
    mute: true,
    vmute: true 
  }) ;

  this._endpoint.joinConference(name. opts, function( err, connection) {
    cb(err, connection) ;
  }) ;
}

util.inherits(Conference, Emitter) ;

module.exports = exports = Conference ;

/**
 * destroy the conference, releasing all legs
 * @param  {Conference~destroyCallback} cb - callback invoked when conference has been destroyed
 */
Conference.prototype.destroy = function(cb) {
  cb(null) ;
} ;
/**
 * This callback is invoked when a conference has been destroyed
 * @callback Conference~destroyCallback
 * @param {Error} error, if any
 */

//conference event handlers
Conference.prototype.onAddMember = function( evt ) {
  this.memberId = evt.getHeader('Member-ID') ;
  debug('addMember, conference is now ', JSON.stringify(this)) ;
} ;

// esl connection event handlers
Conference.prototype._onConferenceEvent = function( evt ) {
  var eventName = evt.getHeader('Event-Subclass') ;
  if( eventName === 'conference::maintenance') {
    var action = evt.getHeader('Action') ;
    debug('conference event action: ', action) ;

    //invoke a handler for this action, if we have defined one
    (Conference.prototype['on' + _.capitalize(_.camelCase(action))] || noop).bind( this, evt )() ;

  }
  else {
    debug('got custom event: ', eventName ) ;
  }
}; 

// representation
Conference.prototype.toJSON = function() {
  return( only( this, 'name state memberId')) ;
} ;
Conference.prototype.toString = function() {
  return this.toJSON().toString() ;
} ;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Conference.html">Conference</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="MediaServer.html">MediaServer</a></li><li><a href="Mrf.html">Mrf</a></li></ul><h3>Events</h3><ul><li><a href="MediaServer.html#event:connect">connect</a></li><li><a href="MediaServer.html#event:error">error</a></li><li><a href="MediaServer.html#event:ready">ready</a></li><li><a href="Mrf.html#event:error">error</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Thu Oct 29 2015 15:01:07 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
